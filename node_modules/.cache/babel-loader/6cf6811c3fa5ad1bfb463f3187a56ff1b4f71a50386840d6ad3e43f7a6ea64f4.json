{"ast":null,"code":"\"use strict\";\n\nconst {\n  nanoid\n} = require('nanoid');\nconst pluralize = require('pluralize');\nmodule.exports = {\n  getRemovable,\n  createId,\n  deepQuery\n};\n\n// Returns document ids that have unsatisfied relations\n// Example: a comment that references a post that doesn't exist\nfunction getRemovable(db, opts) {\n  const _ = this;\n  const removable = [];\n  _.each(db, (coll, collName) => {\n    _.each(coll, doc => {\n      _.each(doc, (value, key) => {\n        if (new RegExp(`${opts.foreignKeySuffix}$`).test(key)) {\n          // Remove foreign key suffix and pluralize it\n          // Example postId -> posts\n          const refName = pluralize.plural(key.replace(new RegExp(`${opts.foreignKeySuffix}$`), ''));\n          // Test if table exists\n          if (db[refName]) {\n            // Test if references is defined in table\n            const ref = _.getById(db[refName], value);\n            if (_.isUndefined(ref)) {\n              removable.push({\n                name: collName,\n                id: doc.id\n              });\n            }\n          }\n        }\n      });\n    });\n  });\n  return removable;\n}\n\n// Return incremented id or uuid\n// Used to override lodash-id's createId with utils.createId\nfunction createId(coll) {\n  const _ = this;\n  const idProperty = _.__id();\n  if (_.isEmpty(coll)) {\n    return 1;\n  } else {\n    let id = _(coll).maxBy(idProperty)[idProperty];\n\n    // Increment integer id or generate string id\n    return _.isFinite(id) ? ++id : nanoid(7);\n  }\n}\nfunction deepQuery(value, q) {\n  const _ = this;\n  if (value && q) {\n    if (_.isArray(value)) {\n      for (let i = 0; i < value.length; i++) {\n        if (_.deepQuery(value[i], q)) {\n          return true;\n        }\n      }\n    } else if (_.isObject(value) && !_.isArray(value)) {\n      for (const k in value) {\n        if (_.deepQuery(value[k], q)) {\n          return true;\n        }\n      }\n    } else if (value.toString().toLowerCase().indexOf(q) !== -1) {\n      return true;\n    }\n  }\n}","map":{"version":3,"names":["nanoid","require","pluralize","module","exports","getRemovable","createId","deepQuery","db","opts","_","removable","each","coll","collName","doc","value","key","RegExp","foreignKeySuffix","test","refName","plural","replace","ref","getById","isUndefined","push","name","id","idProperty","__id","isEmpty","maxBy","isFinite","q","isArray","i","length","isObject","k","toString","toLowerCase","indexOf"],"sources":["/Users/maxympetlyak/Desktop/REDUX/hero_admin_panel_template/node_modules/json-server/lib/server/mixins.js"],"sourcesContent":["\"use strict\";\n\nconst {\n  nanoid\n} = require('nanoid');\nconst pluralize = require('pluralize');\nmodule.exports = {\n  getRemovable,\n  createId,\n  deepQuery\n};\n\n// Returns document ids that have unsatisfied relations\n// Example: a comment that references a post that doesn't exist\nfunction getRemovable(db, opts) {\n  const _ = this;\n  const removable = [];\n  _.each(db, (coll, collName) => {\n    _.each(coll, doc => {\n      _.each(doc, (value, key) => {\n        if (new RegExp(`${opts.foreignKeySuffix}$`).test(key)) {\n          // Remove foreign key suffix and pluralize it\n          // Example postId -> posts\n          const refName = pluralize.plural(key.replace(new RegExp(`${opts.foreignKeySuffix}$`), ''));\n          // Test if table exists\n          if (db[refName]) {\n            // Test if references is defined in table\n            const ref = _.getById(db[refName], value);\n            if (_.isUndefined(ref)) {\n              removable.push({\n                name: collName,\n                id: doc.id\n              });\n            }\n          }\n        }\n      });\n    });\n  });\n  return removable;\n}\n\n// Return incremented id or uuid\n// Used to override lodash-id's createId with utils.createId\nfunction createId(coll) {\n  const _ = this;\n  const idProperty = _.__id();\n  if (_.isEmpty(coll)) {\n    return 1;\n  } else {\n    let id = _(coll).maxBy(idProperty)[idProperty];\n\n    // Increment integer id or generate string id\n    return _.isFinite(id) ? ++id : nanoid(7);\n  }\n}\nfunction deepQuery(value, q) {\n  const _ = this;\n  if (value && q) {\n    if (_.isArray(value)) {\n      for (let i = 0; i < value.length; i++) {\n        if (_.deepQuery(value[i], q)) {\n          return true;\n        }\n      }\n    } else if (_.isObject(value) && !_.isArray(value)) {\n      for (const k in value) {\n        if (_.deepQuery(value[k], q)) {\n          return true;\n        }\n      }\n    } else if (value.toString().toLowerCase().indexOf(q) !== -1) {\n      return true;\n    }\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}